---
- name: Bootstrap Infrastructure
  hosts: all
  gather_facts: yes
  
  pre_tasks:
    - name: Include wait for connection
      include_tasks: ../tasks/wait-for-connection.yml
      tags: [always]
  
- import_playbook: bootstrap.yml
- import_playbook: security.yml
- import_playbook: mount.yml
- import_playbook: setup-docker.yml

# =====================================
# Docker 环境和工具准备
# =====================================
- name: Setup Docker Environment and Tools
  hosts: all
  gather_facts: yes
  become: yes
  
  tasks:
    - name: 显示基础设施准备完成信息
      debug:
        msg:
          - "✅ Docker 基础设施准备完成"
          - "共享网络: shared_network (172.30.0.0/16)"
          - "零停机工具: docker rollout 已安装"
          - ""
          - "下一步: 部署独立服务（每个服务自动创建所需目录）"
          - "  mise deploy-infra postgres"
          - "  mise deploy-infra redis"
          - "  mise deploy-infra caddy"
      tags: [info]
